<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProgTerm</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: #000000;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            font-size: 24px;
        }
        
        .typewriter-text {
            border-right: 2px solid #ffffff;
            animation: blink-cursor 1s infinite;
            min-height: 30px;
            display: flex;
            align-items: center;
        }
        
        @keyframes blink-cursor {
            0%, 50% { border-right-color: #ffffff; }
            51%, 100% { border-right-color: transparent; }
        }
        
        .loading-screen.fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        
        .loading-screen.hidden {
            display: none;
        }
        
        .terminal-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        /* Hamburger Menu */
        .hamburger-menu {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }
        
        .hamburger-line {
            width: 100%;
            height: 1px;
            background-color: #ffffff;
            transition: 0.3s;
        }
        
        .hamburger-menu.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .hamburger-menu.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger-menu.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: -350px;
            width: 350px;
            height: 100vh;
            background-color: #111111;
            border-right: 1px solid #333;
            transition: left 0.3s ease;
            z-index: 999;
            padding: 60px 20px 20px 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .favorite-item {
            background-color: #1a1a1a;
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .favorite-item:hover {
            background-color: #2a2a2a;
        }
        
        .favorite-english {
            font-size: 14px;
            font-weight: bold;
            color: #ffffff;
        }
        
        .favorite-turkish {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
        
        .favorite-remove {
            float: right;
            color: #ff6b6b;
            font-size: 16px;
            cursor: pointer;
            margin-top: -2px;
        }
        
        .no-favorites {
            color: #666;
            font-style: italic;
            text-align: center;
            margin-top: 50px;
        }
        
        .search-container {
            position: absolute;
            top: 75px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-input {
            background-color: #000;
            color: #ffffff;
            border: 1px solid #ffffff;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            outline: none;
            width: 220px;
            height: 36px;
            box-sizing: border-box;
        }
        
        .search-btn, .bookmark-btn {
            background-color: #000;
            color: #ffffff;
            border: 1px solid #ffffff;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            font-size: 16px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            padding: 0;
            filter: grayscale(100%);
        }
        
        .search-btn:hover, .bookmark-btn:hover {
            background-color: #ffffff;
            color: #000;
        }
        
        .bookmark-btn.favorited {
            background-color: #ffd180;
            color: #000;
        }
        
        .term-display {
            text-align: center;
            max-width: 80%;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .term-english {
            font-size: 36px;
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 10px;
            text-transform: uppercase;
            cursor: pointer;
            position: relative;
            transition: color 0.2s;
        }
        
        .term-english:hover {
            color: #ffd180;
        }
        
        .term-english.has-note {
            color: #ffd180;
        }
        
        .term-english.has-note::after {
            content: "📋";
            font-size: 24px;
            margin-left: 10px;
            color: #ffffff;
            animation: pulse 2s infinite;
            filter: grayscale(100%);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .term-pronunciation {
            font-size: 14px;
            color: #888;
            margin-bottom: 15px;
        }
        
        .term-turkish {
            font-size: 24px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 15px;
        }
        
        .term-category {
            font-size: 14px;
            font-weight: 400;
            color: #ffd180;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .term-description {
            font-size: 16px;
            font-weight: 300;
            color: #ffffff;
            line-height: 1.6;
            margin-bottom: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .term-example {
            font-size: 14px;
            font-weight: 300;
            color: #ffffff;
            font-style: italic;
            margin-bottom: 20px;
        }
        
        .note-hint {
            font-size: 14px;
            font-weight: 300;
            color: #ffffff;
            font-style: normal;
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            white-space: nowrap;
        }
        
        .note-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .note-modal.active {
            display: flex;
        }
        
        .note-container {
            background-color: #000000;
            border: 2px solid #ffffff;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            padding: 20px;
            font-family: 'Courier New', monospace;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .note-header {
            color: #ffffff;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 1px solid #ffffff;
            padding-bottom: 10px;
        }
        
        .note-textarea {
            width: 100%;
            min-height: 200px;
            background-color: #000;
            color: #ffffff;
            border: 1px solid #ffffff;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            outline: none;
            box-sizing: border-box;
        }
        
        .note-textarea:focus {
            border-color: #ffffff;
            box-shadow: 0 0 5px #ffffff;
        }
        
        .note-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: space-between;
            align-items: center;
        }
        
        .note-btn {
            background-color: #000;
            color: #ffffff;
            border: 1px solid #ffffff;
            padding: 8px 16px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .note-btn:hover {
            background-color: #ffffff;
            color: #000;
        }
        
        .note-btn.delete {
            border-color: #ffffff;
            color: #ffffff;
        }
        
        .note-btn.delete:hover {
            background-color: #ffffff;
            color: #000;
        }
        
        .note-info {
            font-size: 10px;
            color: #ffffff;
        }
        
        .note-display {
            display: none;
        }
        
        .no-results {
            color: #ffffff;
            font-size: 18px;
            text-align: center;
        }
        
        .loading {
            color: #ffffff;
            font-size: 18px;
            text-align: center;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .error {
            color: #ff6b6b;
            font-size: 18px;
            text-align: center;
            padding: 20px;
            border: 1px solid #ff6b6b;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .navigation {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 30px;
            width: 80%;
            max-width: 600px;
            justify-content: space-between;
        }
        
        .nav-btn {
            background-color: #000;
            color: #ffffff;
            border: none;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .nav-btn:hover {
            color: #888;
        }
        
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .term-counter {
            font-size: 18px;
            color: #ffffff;
            padding: 10px 20px;
            white-space: nowrap;
        }
        
        .current-number {
            font-weight: 300;
        }
        
        .total-number {
            font-weight: 900;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 998;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }
        
        @media (max-width:768px){
            .search-input {width:180px;}
            .search-btn, .bookmark-btn {width: 32px; height: 32px; font-size: 14px;}
            .search-input {height: 32px; font-size: 12px;}
            .term-english {font-size:24px;}
            .term-turkish {font-size:18px;}
            .term-description {font-size:14px;}
            .nav-btn {width:50px;height:50px;font-size:20px;}
            .sidebar {width: 100%; left: -100%;}
            .note-container {width: 95%; padding: 15px;}
            .note-textarea {min-height: 150px;}
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="typewriter-text" id="typewriterText"></div>
    </div>

    <!-- Note Modal -->
    <div class="note-modal" id="noteModal">
        <div class="note-container">
            <div class="note-header" id="noteHeader">
                NOT EKLE/DÜZENLE
            </div>
            <textarea class="note-textarea" id="noteTextarea" placeholder="Notunuzu buraya yazın..."></textarea>
            <div class="note-controls">
                <div class="note-info">
                    <span id="charCount">0</span>/1000 karakter
                </div>
                <div>
                    <button class="note-btn delete" id="deleteNoteBtn" onclick="deleteNote()">SİL</button>
                    <button class="note-btn" onclick="saveNote()">KAYDET</button>
                    <button class="note-btn" onclick="closeNoteModal()">İPTAL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hamburger Menu -->
    <div class="hamburger-menu" onclick="toggleSidebar()">
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
    </div>

    <!-- Overlay -->
    <div class="overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div id="favoritesList">
            <div class="no-favorites">
                Henüz favori terim eklemediniz.<br><br>
                Bir terimi favorilere eklemek için ★ butonunu kullanın.
            </div>
        </div>
    </div>

    <div class="terminal-body">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="">
            <button class="search-btn" onclick="searchTerms()" title="Ara">🔍</button>
            <button class="search-btn" onclick="clearSearch()" title="Temizle">✕</button>
            <button class="bookmark-btn" id="bookmarkBtn" onclick="toggleBookmark()" title="Favorilere Ekle">☆</button>
        </div>
        
        <div class="term-display" id="termDisplay">
            <div class="loading">
                Veriler yükleniyor...<br>
                Cache kontrol ediliyor...
            </div>
        </div>
        
        <div class="navigation">
            <button class="nav-btn" id="prevBtn" onclick="previousTerm()" aria-label="Önceki terim">◀</button>
            <div class="term-counter">
                <span id="currentIndex" class="current-number">0</span> / <span id="totalTerms" class="total-number">0</span>
            </div>
            <button class="nav-btn" id="nextBtn" onclick="nextTerm()" aria-label="Sonraki terim">▶</button>
        </div>
    </div>

    <script>
        // Global değişkenler
        let allTerms = [];
        let currentTerms = [];
        let currentIndex = 0;
        let isDataLoaded = false;
        let favorites = [];
        let notes = {};
        let currentEditingTerm = null;

        // Cache ve API ayarları
        const CACHE_KEY = 'programming_terms_cache';
        const FAVORITES_KEY = 'programming_favorites';
        const NOTES_KEY = 'programming_notes';
        const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 saat
        const GITHUB_JSON_URL = 'https://raw.githubusercontent.com/umittasdemir1/Terimler_Sozlugu/refs/heads/main/terms.json';

        // Typewriter efekti
        async function typeWriter(text, element, speed = 100) {
            element.textContent = '';
            for (let i = 0; i < text.length; i++) {
                element.textContent += text.charAt(i);
                await new Promise(resolve => setTimeout(resolve, speed));
            }
        }

        // Silme efekti
        async function eraseText(element, speed = 50) {
            const text = element.textContent;
            for (let i = text.length; i > 0; i--) {
                element.textContent = text.substring(0, i - 1);
                await new Promise(resolve => setTimeout(resolve, speed));
            }
        }

        // Loading screen animasyonu
        async function showLoadingAnimation() {
            const typewriterElement = document.getElementById('typewriterText');
            
            try {
                // "Merhaba Dünya..." yazısını yaz
                await typeWriter('Merhaba Dünya...', typewriterElement, 120);
                
                // 1 saniye bekle
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Yazıyı sil
                await eraseText(typewriterElement, 80);
                
                // 0.5 saniye bekle
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Loading screen'i kapat
                const loadingScreen = document.getElementById('loadingScreen');
                loadingScreen.classList.add('fade-out');
                
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                }, 500);
                
            } catch (error) {
                console.error('Loading animasyon hatası:', error);
                // Hata durumunda direkt kapat
                document.getElementById('loadingScreen').classList.add('hidden');
            }
        }

        // Cache fonksiyonları
        function saveToCache(data) {
            const cacheData = {
                terms: data,
                timestamp: Date.now()
            };
            try {
                localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));
                console.log('Veriler cache\'e kaydedildi');
            } catch (e) {
                console.error('Cache kaydetme hatası:', e);
            }
        }

        function loadFromCache() {
            try {
                const cached = localStorage.getItem(CACHE_KEY);
                if (cached) {
                    const data = JSON.parse(cached);
                    if (Date.now() - data.timestamp < CACHE_DURATION) {
                        console.log('Veriler cache\'den yüklendi');
                        return data.terms;
                    } else {
                        console.log('Cache süresi dolmuş, yeniden çekiliyor');
                        localStorage.removeItem(CACHE_KEY);
                    }
                }
            } catch (e) {
                console.error('Cache okuma hatası:', e);
                localStorage.removeItem(CACHE_KEY);
            }
            return null;
        }

        // Favori fonksiyonları
        function loadFavorites() {
            try {
                const saved = localStorage.getItem(FAVORITES_KEY);
                if (saved) {
                    favorites = JSON.parse(saved);
                    updateFavoritesList();
                }
            } catch (e) {
                console.error('Favoriler yükleme hatası:', e);
                favorites = [];
            }
        }

        // Not fonksiyonları
        function loadNotes() {
            try {
                const saved = localStorage.getItem(NOTES_KEY);
                if (saved) {
                    notes = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Notlar yükleme hatası:', e);
                notes = {};
            }
        }

        function saveNotes() {
            try {
                localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
            } catch (e) {
                console.error('Notlar kaydetme hatası:', e);
            }
        }

        function getTermKey(term) {
            return `${term.english}_${term.turkish}`.toLowerCase().replace(/[^a-z0-9]/g, '_');
        }

        function hasNote(term) {
            const key = getTermKey(term);
            return notes[key] && notes[key].trim() !== '';
        }

        function openNoteModal(term) {
            currentEditingTerm = term;
            const key = getTermKey(term);
            const existingNote = notes[key] || '';
            
            document.getElementById('noteHeader').textContent = `${term.english.toUpperCase()} - NOT`;
            document.getElementById('noteTextarea').value = existingNote;
            document.getElementById('charCount').textContent = existingNote.length;
            document.getElementById('deleteNoteBtn').style.display = existingNote ? 'inline-block' : 'none';
            document.getElementById('noteModal').classList.add('active');
            
            // Focus textarea
            setTimeout(() => {
                document.getElementById('noteTextarea').focus();
            }, 300);
        }

        function closeNoteModal() {
            document.getElementById('noteModal').classList.remove('active');
            currentEditingTerm = null;
        }

        function saveNote() {
            if (!currentEditingTerm) return;
            
            const noteText = document.getElementById('noteTextarea').value.trim();
            const key = getTermKey(currentEditingTerm);
            
            if (noteText) {
                notes[key] = noteText;
                showMessage('Not kaydedildi!');
            } else {
                delete notes[key];
                showMessage('Not silindi!');
            }
            
            saveNotes();
            displayCurrentTerm(); // Terim görünümünü güncelle
            closeNoteModal();
        }

        function deleteNote() {
            if (!currentEditingTerm) return;
            
            const key = getTermKey(currentEditingTerm);
            delete notes[key];
            saveNotes();
            
            showMessage('Not silindi!');
            displayCurrentTerm();
            closeNoteModal();
        }

        // Karakter sayacı
        document.addEventListener('DOMContentLoaded', function() {
            const textarea = document.getElementById('noteTextarea');
            if (textarea) {
                textarea.addEventListener('input', function() {
                    const count = this.value.length;
                    const maxLength = 1000;
                    
                    if (count > maxLength) {
                        this.value = this.value.substring(0, maxLength);
                        return;
                    }
                    
                    document.getElementById('charCount').textContent = count;
                    
                    // Otomatik kaydetme (3 saniye sonra)
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(() => {
                        if (currentEditingTerm && this.value.trim() !== '') {
                            const key = getTermKey(currentEditingTerm);
                            notes[key] = this.value.trim();
                            saveNotes();
                            showMessage('Not otomatik kaydedildi!');
                        }
                    }, 3000);
                });
            }
        });

        function saveFavorites() {
            try {
                localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
            } catch (e) {
                console.error('Favoriler kaydetme hatası:', e);
            }
        }

        function toggleBookmark() {
            if (!isDataLoaded || currentTerms.length === 0) return;
            
            const currentTerm = currentTerms[currentIndex];
            const existingIndex = favorites.findIndex(fav => 
                fav.english === currentTerm.english && fav.turkish === currentTerm.turkish
            );
            
            if (existingIndex !== -1) {
                // Favorilerden çıkar
                favorites.splice(existingIndex, 1);
                showMessage('Favorilerden çıkarıldı!');
            } else {
                // Favorilere ekle
                favorites.push({
                    english: currentTerm.english,
                    turkish: currentTerm.turkish,
                    description: currentTerm.description,
                    category: currentTerm.category,
                    categoryTurkish: currentTerm.categoryTurkish,
                    example: currentTerm.example,
                    pronunciation: currentTerm.pronunciation
                });
                showMessage('Favorilere eklendi!');
            }
            
            saveFavorites();
            updateFavoritesList();
            updateBookmarkButton();
        }

        function updateBookmarkButton() {
            if (!isDataLoaded || currentTerms.length === 0) return;
            
            const currentTerm = currentTerms[currentIndex];
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const isFavorited = favorites.some(fav => 
                fav.english === currentTerm.english && fav.turkish === currentTerm.turkish
            );
            
            if (isFavorited) {
                bookmarkBtn.classList.add('favorited');
                bookmarkBtn.textContent = '★';
                bookmarkBtn.title = 'Favorilerden Çıkar';
            } else {
                bookmarkBtn.classList.remove('favorited');
                bookmarkBtn.textContent = '☆';
                bookmarkBtn.title = 'Favorilere Ekle';
            }
        }

        function updateFavoritesList() {
            const favoritesList = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = `
                    <div class="no-favorites">
                        Henüz favori terim eklemediniz.<br><br>
                        Bir terimi favorilere eklemek için ★ butonunu kullanın.
                    </div>
                `;
                return;
            }
            
            favoritesList.innerHTML = favorites.map((fav, index) => `
                <div class="favorite-item" onclick="goToFavorite(${index})">
                    <span class="favorite-remove" onclick="removeFavorite(${index}); event.stopPropagation();">×</span>
                    <div class="favorite-english">${fav.english}</div>
                    <div class="favorite-turkish">${fav.turkish}</div>
                </div>
            `).join('');
        }

        function removeFavorite(index) {
            favorites.splice(index, 1);
            saveFavorites();
            updateFavoritesList();
            updateBookmarkButton();
            showMessage('Favorilerden çıkarıldı!');
        }

        function goToFavorite(index) {
            const favorite = favorites[index];
            
            // Tüm terimlerde bu favoriteyi bul
            const termIndex = allTerms.findIndex(term => 
                term.english === favorite.english && term.turkish === favorite.turkish
            );
            
            if (termIndex !== -1) {
                // Arama temizle ve o terime git
                clearSearch();
                currentIndex = termIndex;
                displayCurrentTerm();
                closeSidebar();
                showMessage(`${favorite.english} terimine gidildi!`);
            }
        }

        // Sidebar fonksiyonları
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const hamburger = document.querySelector('.hamburger-menu');
            const overlay = document.querySelector('.overlay');
            
            sidebar.classList.toggle('active');
            hamburger.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const hamburger = document.querySelector('.hamburger-menu');
            const overlay = document.querySelector('.overlay');
            
            sidebar.classList.remove('active');
            hamburger.classList.remove('active');
            overlay.classList.remove('active');
        }

        // Mesaj gösterme
        function showMessage(text) {
            // Basit bir toast mesajı
            const existingMsg = document.querySelector('.toast-message');
            if (existingMsg) existingMsg.remove();
            
            const msg = document.createElement('div');
            msg.className = 'toast-message';
            msg.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #333;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 10000;
                font-family: 'Courier New', monospace;
            `;
            msg.textContent = text;
            document.body.appendChild(msg);
            
            setTimeout(() => msg.remove(), 2000);
        }

        // Telaffuz fonksiyonu - temel telaffuz üreteci
        function getPronunciation(word) {
            const pronMap = {
                "Algorithm":"al-go-ri-tm","API":"ey-pi-ay","Array":"a-rey","Backend":"bek-end","Boolean":"bu-li-an",
                "Bug":"bag","Cache":"keş","Class":"klas","Compiler":"kom-pay-lır","CSS":"si-es-es","Database":"dey-ta-beys",
                "Debug":"di-bag","DOM":"di-o-em","Framework":"freym-vörk","Frontend":"fır-ont-end","Function":"fank-şın",
                "Git":"git","HTML":"eyç-ti-em-el","HTTP":"eyç-ti-ti-pi","IDE":"ay-di-i","JavaScript":"ca-va-sik-ript",
                "JSON":"cey-sın","Library":"lay-bre-ri","Loop":"lup","Method":"me-tod","Object":"ob-cekt","Parameter":"pa-ra-mi-tır",
                "Python":"pay-ton","Repository":"ri-po-zi-to-ri","Server":"sör-vır","SQL":"es-kyo-el","String":"si-tring",
                "Variable":"ver-i-yı-bıl","Version Control":"vör-şın kon-trol","Web Development":"veb di-ve-lop-mınt",
                "Binary":"bay-ne-ri","Bootstrap":"but-si-trap","Client":"klay-ınt","Cloud Computing":"klaud kom-pyu-ting",
                "Data Structure":"dey-ta si-trak-çır","DevOps":"dev-ops","Docker":"dok-kır","Encryption":"in-kırp-şın",
                "Firebase":"fay-ır-beys","GitHub":"git-hab","Hash":"heş","Interface":"in-tır-feys","jQuery":"cey-kvo-ri",
                "Kubernetes":"ku-ber-ne-tis","Linux":"li-naks","Machine Learning":"mı-şin lör-ning","Node.js":"nod-cey-es",
                "OOP":"o-o-pi","PHP":"pi-eyç-pi","React":"ri-ekt","REST API":"rest ey-pi-ay","Software":"soft-ver",
                "TypeScript":"tayp-sik-ript","URL":"yu-ar-el","Vue.js":"vyu-cey-es","Webpack":"veb-pek","XML":"eks-em-el"
            };
            return pronMap[word] || word.toLowerCase().replace(/[^a-z]/g, "-");
        }

        // Ana veri yükleme fonksiyonu
        async function loadTermsData() {
            // Önce cache'den dene
            const cachedData = loadFromCache();
            if (cachedData) {
                allTerms = cachedData;
                currentTerms = [...allTerms];
                isDataLoaded = true;
                displayCurrentTerm();
                return;
            }

            // Cache'de yoksa GitHub'dan çek
            await loadTermsFromGitHub();
        }

        // GitHub'dan JSON verisini çek
        async function loadTermsFromGitHub() {
            try {
                const response = await fetch(GITHUB_JSON_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP Hatası: ${response.status} - ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // JSON yapısını kontrol et
                if (!Array.isArray(data)) {
                    throw new Error('JSON formatı hatalı: Veri bir dizi olmalı');
                }
                
                // Hatalı verileri filtrele
                allTerms = data.filter(term => 
                    term && 
                    term.english && term.english.trim() !== '' &&
                    term.turkish && term.turkish.trim() !== ''
                );
                
                currentTerms = [...allTerms];
                isDataLoaded = true;
                
                // Cache'e kaydet
                saveToCache(allTerms);
                
                console.log(`${allTerms.length} terim başarıyla yüklendi`);
                displayCurrentTerm();
                
            } catch (error) {
                console.error('Veri yükleme hatası:', error);
                showError(`Veriler yüklenemedi: ${error.message}`);
            }
        }

        // Hata mesajı göster
        function showError(message) {
            document.getElementById('termDisplay').innerHTML = `
                <div class="error">
                    <strong>HATA!</strong><br><br>
                    ${message}<br><br>
                    <small>
                        • İnternet bağlantınızı kontrol edin<br>
                        • GitHub repository'sine erişim var mı kontrol edin<br>
                        • JSON dosyası formatı doğru mu kontrol edin<br>
                        • Birkaç saniye sonra sayfayı yenileyin
                    </small>
                </div>
            `;
            updateNavigation();
        }

        // Mevcut terimi göster
        function displayCurrentTerm() {
            if (!isDataLoaded) {
                return;
            }

            if (currentTerms.length === 0) {
                document.getElementById('termDisplay').innerHTML = `
                    <div class="no-results">
                        ARAMA SONUCU YOK!<br><br>
                        Arama kriterlerinizi değiştirin.
                    </div>
                `;
                updateNavigation();
                return;
            }

            const term = currentTerms[currentIndex];
            
            // JSON'dan gelen veriyi kontrol et
            if (!term.english || !term.turkish) {
                console.error('Hatalı terim verisi:', term);
                return;
            }

            document.getElementById('termDisplay').innerHTML = `
                <div class="term-english ${hasNote(term) ? 'has-note' : ''}" onclick="openNoteModal(currentTerms[currentIndex])">${term.english}</div>
                <div class="term-pronunciation">(${term.pronunciation || getPronunciation(term.english)})</div>
                <div class="term-turkish">${term.turkish}</div>
                <div class="term-category">${term.categoryTurkish || 'Genel'} (${term.category || 'General'})</div>
                <div class="term-description">${term.description || 'Açıklama bulunmuyor.'}</div>
                <div class="term-example">${term.example || ''}</div>
                <div class="note-hint">Terime not eklemek için başlığa tıklayın</div>
            `;
            
            updateNavigation();
            updateBookmarkButton();
        }

        // Navigasyon güncelle
        function updateNavigation() {
            document.getElementById('currentIndex').textContent = currentTerms.length > 0 ? currentIndex + 1 : 0;
            document.getElementById('totalTerms').textContent = currentTerms.length;
            
            // Butonları etkinleştir/devre dışı bırak
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = !isDataLoaded || currentTerms.length === 0;
            nextBtn.disabled = !isDataLoaded || currentTerms.length === 0;
        }

        // Sonraki terim
        function nextTerm() {
            if (!isDataLoaded || currentTerms.length === 0) return;
            
            if (currentIndex < currentTerms.length - 1) {
                currentIndex++;
            } else {
                currentIndex = 0; // Son terimden sonra başa dön
            }
            displayCurrentTerm();
        }

        // Önceki terim
        function previousTerm() {
            if (!isDataLoaded || currentTerms.length === 0) return;
            
            if (currentIndex > 0) {
                currentIndex--;
            } else {
                currentIndex = currentTerms.length - 1; // İlk terimden önce sona git
            }
            displayCurrentTerm();
        }

        // Terim ara
        function searchTerms() {
            if (!isDataLoaded) {
                showMessage('Veriler henüz yüklenmedi. Lütfen bekleyin.');
                return;
            }

            const searchText = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (searchText === '') {
                currentTerms = [...allTerms];
            } else {
                currentTerms = allTerms.filter(term => 
                    (term.english && term.english.toLowerCase().includes(searchText)) ||
                    (term.turkish && term.turkish.toLowerCase().includes(searchText)) ||
                    (term.description && term.description.toLowerCase().includes(searchText)) ||
                    (term.categoryTurkish && term.categoryTurkish.toLowerCase().includes(searchText)) ||
                    (term.category && term.category.toLowerCase().includes(searchText))
                );
            }
            
            currentIndex = 0;
            displayCurrentTerm();
        }

        // Aramayı temizle
        function clearSearch() {
            if (!isDataLoaded) return;
            
            document.getElementById('searchInput').value = '';
            currentTerms = [...allTerms];
            currentIndex = 0;
            displayCurrentTerm();
        }

        // Klavye kısayolları
        document.addEventListener('keydown', function(e) {
            if (!isDataLoaded) return;
            
            // Sidebar açıkken klavye kısayollarını devre dışı bırak
            if (document.getElementById('sidebar').classList.contains('active')) {
                if (e.key === 'Escape') {
                    closeSidebar();
                }
                return;
            }
            
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    previousTerm();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    nextTerm();
                    break;
                case 'Enter':
                    if (document.activeElement === document.getElementById('searchInput')) {
                        searchTerms();
                    }
                    break;
                case 'Escape':
                    clearSearch();
                    break;
                case 'f':
                case 'F':
                    if (document.activeElement !== document.getElementById('searchInput')) {
                        e.preventDefault();
                        toggleBookmark();
                    }
                    break;
                case 'n':
                case 'N':
                    if (document.activeElement !== document.getElementById('searchInput') && currentTerms.length > 0) {
                        e.preventDefault();
                        openNoteModal(currentTerms[currentIndex]);
                    }
                    break;
            }
        });

        // Enter tuşu ile arama
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchTerms();
            }
        });

        // Note modal ESC ile kapanma
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('noteModal').classList.contains('active')) {
                closeNoteModal();
            }
        });

        // Note modal dışına tıklayınca kapanma
        document.getElementById('noteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNoteModal();
            }
        });

        // Sayfa yüklendiğinde çalış
        window.addEventListener('load', async function() {
            console.log('Sayfa yüklendi, loading animasyonu başlatılıyor...');
            
            // Loading animasyonu ve veri yüklemeyi paralel başlat
            loadFavorites();
            loadNotes();
            
            const animationPromise = showLoadingAnimation();
            const dataPromise = loadTermsData();
            
            // Animasyon bitsin diye bekle
            await animationPromise;
            
            // Veriler yüklenmişse göster, değilse loading mesajı göster
            if (isDataLoaded) {
                displayCurrentTerm();
            } else {
                document.getElementById('termDisplay').innerHTML = `
                    <div class="loading">
                        Veriler yükleniyor...<br>
                        GitHub'dan JSON verisi çekiliyor...
                    </div>
                `;
                // Veri yüklemesinin bitmesini bekle
                await dataPromise;
            }
        });

        // Hata durumunda sayfa yenileme seçeneği
        window.addEventListener('error', function(e) {
            console.error('JavaScript Hatası:', e.error);
        });

        // Network hatalarını yakala
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise Hatası:', e.reason);
        });
    </script>
</body>
</html>
